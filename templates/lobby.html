{% extends "layout_user.html" %}

{% block title %}
    Lobby
{% endblock %}

{% block main %}
<div style="margin-bottom: 80px;">

<h3 style="font-size: 30px; color: #333; margin-top: 10px; margin-bottom: 20px;">{{ group_name }}</h3>
<form action="/chat" method="GET">
    <input type="hidden" name="group_id" value="{{ group_id }}">
    <input type="hidden" name="group_name" value="{{ group_name }}">
    <button type="submit" class="block" style="font-weight: bold; margin-bottom: 10px;">CHAT</button>
</form>

{% for row in group_info %}
<table class="table" style="margin-bottom: 10px;">
    <tbody>
        <tr>
            <td>{{ row['sport'] }}</td>
            <td>{{ row['start_time'] }} - {{ row['end_time'] }} {{ row['date'] }}</td>
            <td>{{ row['language'] }}</td>
            <td>{{ row['user_count'] }}</td>
        </tr>
    </tbody>
</table>
{% endfor %}
<table class="table table-striped mobile-table">
    <thead>
        <tr>
            <th scope="col">Name</th>
            <th scope="col">Surname</th>
            <th scope="col">State</th>
            <th scope="col">City</th>
            <th scope="col">Language</th>
        </tr>
    </thead>
    <tbody>
        {% for row in users%}

                {% for vote in votes %}
                    {% if vote["voter_id"] == user and vote["member_id"] == row["id"] and vote["voted"] == 0 %}
                    <tr class="hoverable-row" onclick="window.location.href='/user_profile?data-user-id={{ row['id'] }}';" style="cursor: pointer;">
                        <td class="text-nowrap">{{ row["name"] }}</td>
                        <td class="text-nowrap">{{ row["surname"] }}</td>
                        <td class="text-nowrap">{{ row["state"] }}</td>
                        <td class="text-nowrap">{{ row["city"] }}</td>
                        <td class="text-nowrap">{{ row["lang1"] }}</td>

                    </tr>
                    <form action='/vote' method='POST' >
                        <input type="hidden" name="form" value="{{ row['id'] }}">
                        <input type="hidden" name="group_id" value="{{ group_id }}">
                    <tr style="background-color: lightblue;">
                        <td><img src="{{ row['filepath'] }}" class="rounded-square-lobby mobile-image"></td>
                        <td>Skill</td>
                        <td>Fairplay</td>
                        <td>Friendliness</td>
                        <td></td>
                    </tr>
                    <tr style="background-color: lightblue;">
                        <td ></td>
                        <td class="text-nowrap mobile-font-size">

                            {% for i in range(1, 6) %}
                                {% if row["skill"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td class="text-nowrap mobile-font-size">

                            {% for i in range(1, 6) %}
                                {% if row["fairplay"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td class="text-nowrap">

                            {% for i in range(1, 6) %}
                                {% if row["friendliness"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td></td>

                    </tr>
                    <tr style="background-color: lightblue;">
                        <td></td>
                        <td>
                            <select name="skill_vote" class="mobile-select">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="fairplay_vote" class="mobile-select">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td>
                            <select name="friendliness_vote" class="mobile-select">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="5">5</option>
                            </select>
                        </td>
                        <td><button type="submit" class="mobile-button">VOTE</button></td>

                    </tr>
                    </form>
                    {% elif vote["voter_id"] == user and vote["member_id"] == row["id"] and vote["voted"] == 1 %}
                    <tr class="hoverable-row" onclick="window.location.href='/user_profile?data-user-id={{ row['id'] }}';" style="cursor: pointer;">
                        <td>{{ row["name"] }}</td>
                        <td>{{ row["surname"] }}</td>
                        <td>{{ row["state"] }}</td>
                        <td>{{ row["city"] }}</td>
                        <td>{{ row["lang1"] }}</td>

                    </tr>
                    <tr style="background-color: lightyellow;">
                        <td><img src="{{ row['filepath'] }}" class="rounded-square-lobby mobile-image"></td>
                        <td>Skill</td>
                        <td>Fairplay</td>
                        <td>Friendliness</td>
                        <td></td>
                    </tr>
                    <tr style="background-color: lightyellow;">
                        <td></td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["skill"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["fairplay"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["friendliness"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-clipboard2-check" viewBox="0 0 16 16">
                            <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
                            <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
                            <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z"/>
                          </svg></td>
                    </tr>

                    </form>

                    {% elif vote["voter_id"] == row["id"] and vote["member_id"] == row["id"] and vote["voted"] == 1 %}
                    <tr class="hoverable-row" onclick="window.location.href='/user_profile?data-user-id={{ row['id'] }}';" style="cursor: pointer;">
                        <td>{{ row["name"] }}</td>
                        <td>{{ row["surname"] }}</td>
                        <td>{{ row["state"] }}</td>
                        <td>{{ row["city"] }}</td>
                        <td>{{ row["lang1"] }}</td>

                    </tr>
                    <tr style="background-color: lightyellow;">
                        <td><img src="{{ row['filepath'] }}" class="rounded-square-lobby mobile-image"></td>
                        <td>Skill</td>
                        <td>Fairplay</td>
                        <td>Friendliness</td>
                        <td></td>
                    </tr>
                    <tr style="background-color: lightyellow;">
                        <td></td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["skill"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["fairplay"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td>

                            {% for i in range(1, 6) %}
                                {% if row["friendliness"] >= i %}
                                    <span class="fa fa-star checked"></span>
                                {% else %}
                                    <span class="fa fa-star"></span>
                                {% endif%}
                            {% endfor%}

                        </td>
                        <td><svg xmlns="http://www.w3.org/2000/svg" width="13" height="13" fill="currentColor" class="bi bi-clipboard2-check" viewBox="0 0 16 16">
                            <path d="M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"/>
                            <path d="M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"/>
                            <path d="M10.854 7.854a.5.5 0 0 0-.708-.708L7.5 9.793 6.354 8.646a.5.5 0 1 0-.708.708l1.5 1.5a.5.5 0 0 0 .708 0l3-3Z"/>
                          </svg></td>
                    </tr>

                    </form>
                    {% endif%}

                {% endfor %}

        {% endfor %}

    </tbody>

</table>

<h2 style="font-size: 30px; color: #333; margin-top: 10px; margin-bottom: 20px;">Location</h2>
<p id="location-info"></p>
<div id="map" style="height: 400px; width: 400px; margin: 0 auto;"></div>
{% for row in users%}

    {% if row["id"] == user and row["creator"] == 1 %}
    {% if time_check == True %}
    <form id="start_voting" action="/start_voting" method="GET" style="margin-top: 20px;">
        <input type="hidden" name="group_id" value="{{ group_id }}">
        <button class="block" style="font-weight: bold; background-color: #1E90FF">START VOTING</button>
    </form>
    {% endif %}
    <form id="Add friends" action="/settings_group" method="GET" style="margin-top: 20px;">
        <input type="hidden" name="group_id" value="{{ group_id }}">
        <input type="hidden" name="group_name" value="{{ group_name }}">
        <button class="block" style="font-weight: bold; background-color: #1E90FF">SETTINGS</button>
    </form>

    {% endif %}

{% endfor %}
</div>
{% for row in group_info %}
<script>
    // JavaScript function to present a map
    function showMap(latitude, longitude) {
    // Create a map centered at the specified latitude and longitude
    var map = new google.maps.Map(document.getElementById('map'), {
        center: { lat: latitude, lng: longitude },
        zoom: 12
    });

    // Create a marker at the specified location
    var marker = new google.maps.Marker({
        position: { lat: latitude, lng: longitude },
        map: map
    });
    }

    // Call the showMap function after the page has finished loading
    window.addEventListener('load', function() {
        // Retrieve the latitude and longitude values passed from the Flask route
        var latitude = {{ row['location_lati'] }};
        var longitude = {{ row['location_long'] }};

        // Call the showMap function with the latitude and longitude values
        showMap(latitude, longitude);
    });

    var latitude = {{ row['location_lati'] }};
    var longitude = {{ row['location_long'] }};

    // Create a geocoder instance
    var geocoder = new google.maps.Geocoder();

    // Create a LatLng object with the provided latitude and longitude
    var latLng = new google.maps.LatLng(latitude, longitude);

    // Perform reverse geocoding using the LatLng object
    geocoder.geocode({ location: latLng }, function(results, status) {
    if (status === 'OK') {
        if (results[0]) {
        // Extract the location information from the results
        var location = results[0].formatted_address;

        // Display the location information in HTML
        var locationElement = document.getElementById('location-info');
        locationElement.textContent = 'Location: ' + location;
        } else {
        console.log('No results found');
        }
    } else {
        console.log('Geocoder failed due to: ' + status);
    }
    });

</script>
<style>
    .hoverable-row:hover {
     background-color: #1E90FF;
    }

    @media (max-width: 576px) {
      .mobile-table {
        font-size: 10px; /* Adjust the font size as needed */
      }
      .mobile-table td,
      .mobile-table th {
        font-size: 10px; /* Adjust the font size for table cells as needed */
      }
      .mobile-image {
        max-width: 30%; /* Set the maximum width of the image to fit within its container */
        height: auto; /* Allow the height to adjust automatically based on the aspect ratio */
      }
      .mobile-button {
        font-size: 5px; /* Adjust the font size to make the button smaller */
        padding: 1px 5px; /* Adjust the padding to reduce the button size */
      }

      .mobile-select {
        font-size: 5px; /* Adjust the font size to make the select element smaller */
        padding: 2px; /* Adjust the padding to reduce the select element size */
      }
      .table-container {
        max-height: 300px; /* Adjust the maximum height as needed */
        overflow: auto;
      }
      .table thead th {
        padding: 2px; /* Adjust the padding as needed */
      }

      .table tbody td {
        padding: 2px; /* Adjust the padding as needed */
      }
    }
    {box-sizing: border-box;}

    /* Button used to open the contact form - fixed at the bottom of the page */
    .open-button {
    background-color: #555;
    color: white;
    padding: 16px 20px;
    border: none;
    cursor: pointer;
    opacity: 0.8;
    position: center;
    bottom: 23px;
    right: 28px;
    width: 280px;
    }

    /* The popup form - hidden by default */
    .form-popup {
    display: none;
    position: center;
    bottom: 0;
    right: 15px;
    border: 3px solid #f1f1f1;
    z-index: 9;
    }

    /* Add styles to the form container */
    .form-container {
    max-width: 300px;
    padding: 10px;
    background-color: white;
    }

    /* Full-width input fields */
    .form-container input[type=text], .form-container input[type=password] {
    width: 100%;
    padding: 15px;
    margin: 5px 0 22px 0;
    border: none;
    background: #f1f1f1;
    }

    /* When the inputs get focus, do something */
    .form-container input[type=text]:focus, .form-container input[type=password]:focus {
    background-color: #ddd;
    outline: none;
    }

    /* Set a style for the submit/login button */
    .form-container .btn {
    background-color: #04AA6D;
    color: white;
    padding: 16px 20px;
    border: none;
    cursor: pointer;
    width: 100%;
    margin-bottom:10px;
    opacity: 0.8;
    }

    /* Add a red background color to the cancel button */
    .form-container .cancel {
    background-color: red;
    }

    /* Add some hover effects to buttons */
    .form-container .btn:hover, .open-button:hover {
    opacity: 1;
    }
  </style>
{% endfor %}
{% endblock %}

